{
  "id": "DEFAULT",
  "scenario": "DEFAULT",
  "version": 2,
  "initial_step": "STEP_WAIT_UNLOCK",
  "hardware_events": {
    "button_short_1": "BTN_NEXT",
    "button_short_2": "BTN_NEXT",
    "button_short_3": "BTN_NEXT",
    "button_short_4": "BTN_NEXT",
    "button_short_5": "BTN_NEXT",
    "button_long_3": "FORCE_ETAPE2",
    "button_long_4": "FORCE_DONE",
    "espnow_event": "SERIAL:<payload>"
  },
  "app_bindings": [
    "APP_AUDIO",
    "APP_SCREEN",
    "APP_GATE",
    "APP_WIFI",
    "APP_ESPNOW",
    "APP_HARDWARE",
    "APP_CAMERA",
    "APP_MEDIA"
  ],
  "actions_catalog": [
    "ACTION_TRACE_STEP",
    "ACTION_FORCE_ETAPE2",
    "ACTION_REFRESH_SD",
    "ACTION_HW_LED_ALERT",
    "ACTION_HW_LED_READY",
    "ACTION_CAMERA_SNAPSHOT",
    "ACTION_QUEUE_SONAR",
    "ACTION_REC_START",
    "ACTION_REC_STOP",
    "ACTION_SET_BOOT_MEDIA_MANAGER"
  ],
  "steps": [
    {
      "id": "STEP_WAIT_UNLOCK",
      "screen_scene_id": "SCENE_LOCKED",
      "action_ids": [
        "ACTION_TRACE_STEP",
        "ACTION_HW_LED_READY"
      ]
    },
    {
      "id": "STEP_U_SON_PROTO",
      "screen_scene_id": "SCENE_BROKEN",
      "audio_pack_id": "PACK_BOOT_RADIO",
      "action_ids": [
        "ACTION_TRACE_STEP",
        "ACTION_HW_LED_ALERT"
      ]
    },
    {
      "id": "STEP_WAIT_ETAPE2",
      "screen_scene_id": "SCENE_LA_DETECTOR",
      "action_ids": [
        "ACTION_TRACE_STEP",
        "ACTION_QUEUE_SONAR",
        "ACTION_CAMERA_SNAPSHOT",
        "ACTION_REC_START"
      ]
    },
    {
      "id": "STEP_ETAPE2",
      "screen_scene_id": "SCENE_WIN_ETAPE",
      "audio_pack_id": "PACK_WIN",
      "action_ids": [
        "ACTION_TRACE_STEP",
        "ACTION_HW_LED_ALERT"
      ]
    },
    {
      "id": "STEP_DONE",
      "screen_scene_id": "SCENE_CAMERA_SCAN",
      "action_ids": [
        "ACTION_TRACE_STEP",
        "ACTION_REC_STOP",
        "ACTION_HW_LED_READY",
        "ACTION_REFRESH_SD"
      ],
      "transitions": [
        {
          "id": "TR_STEP_DONE_MEDIA",
          "trigger": "on_event",
          "event_type": "serial",
          "event_name": "QR_OK",
          "target_step_id": "STEP_MEDIA_MANAGER",
          "after_ms": 0,
          "priority": 140
        }
      ]
    },
    {
      "id": "STEP_MEDIA_MANAGER",
      "screen_scene_id": "SCENE_MEDIA_MANAGER",
      "action_ids": [
        "ACTION_TRACE_STEP",
        "ACTION_SET_BOOT_MEDIA_MANAGER",
        "ACTION_HW_LED_READY"
      ],
      "mp3_gate_open": true
    }
  ],
  "source": "story_selector",
  "screen_root": "/story/screens",
  "audio_root": "/story/audio"
}
